---
console.log("!!! THE FILE IS RUNNING !!!"); // <--- LOOK FOR THIS

import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const uniqueTags = [...new Set(allPosts.flatMap((post) => post.data.tags || []))];

  console.log("SPY REPORT: Found tags:", uniqueTags); // <--- LOOK FOR THIS

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => 
      post.data.tags && post.data.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Tag: ${tag}`} description={`Posts about ${tag}`} />
		<style>
			ul { list-style-type: none; padding: 0; }
			ul li { margin-bottom: 1rem; }
			ul li a { 
				font-size: 1.2rem; 
				color: var(--accent);
				text-decoration: none; 
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<h2>Posts tagged with #{tag}</h2>
			<ul>
				{posts.map((post) => (
					<li>
                        <!-- Hardcoded path to be safe -->
						<a href={`/my-blog/blog/${post.id.replace('.md', '')}/`}>
							{post.data.title}
						</a>
					</li>
				))}
			</ul>
		</main>
		<Footer />
	</body>
</html>